# 浏览器历史记录管理系统 PRD

## 一、项目概述
### 1.1 项目目标
开发一套浏览器历史记录管理系统，支持 Chrome 系列浏览器，通过插件采集用户的历史记录，并将其存储到后端服务中。用户可通过前端界面查询和筛选历史记录。

### 1.2 核心特点
- 支持实时采集历史记录并上报。
- 后端支持高效查询，基于 Elasticsearch 实现。
- 前端提供现代化简洁界面，支持分页与条件筛选。

---

## 二、功能需求

### 2.1 插件功能
#### 2.1.1 历史记录采集
- 采集访问时间、URL 和域名。
- 支持记录无痕模式下的浏览历史。
- 插件需过滤内网地址（如 `10.x.x.x`、`192.168.x.x`），用户可通过开关控制是否启用此功能。

#### 2.1.2 历史记录上报
- 实时上报历史记录至后端服务。
- 处理上报失败的情况：
  - 未成功上报的记录缓存至浏览器的 IndexedDB。
  - 缓存的记录会定期重试上报。
  - 提供一个开关，控制是否在上报失败时弹窗提示用户。开关默认开启。
  - 弹窗允许用户查看失败原因，并一键重试上报。

#### 2.1.3 配置与开关
- 插件设置页面允许用户：
  - 开启/关闭内网地址过滤功能。
  - 开启/关闭上报失败时的弹窗提示。

---

### 2.2 后端功能
#### 2.2.1 数据存储
- 使用 Elasticsearch 存储历史记录，支持快速查询。
- 存储字段包括：
  - `timestamp`：访问时间。
  - `url`：完整 URL。
  - `domain`：域名。

#### 2.2.2 应用数据管理
- 使用 MongoDB 存储应用相关数据（如系统配置等）。

#### 2.2.3 接口服务
- 插件上报接口：
  - 接受插件上传的历史记录。
  - 支持批量上报。
  - 返回上报状态（成功或失败）。
- 查询接口：
  - 支持按以下条件筛选历史记录：
    - URL 关键字。
    - 域名。
    - 时间范围。
  - 支持分页查询，按最近访问时间降序排列。

#### 2.2.4 日志记录
- 记录每次上报和查询的详细信息，包括时间戳、操作类型、状态、URL 等。
- 日志文件按日期归档，长期保留，无需清理。

---

### 2.3 前端功能
#### 2.3.1 查询页面
- 提供基于 Material Design 风格的界面。
- 支持按以下条件筛选记录：
  - URL 关键字。
  - 域名。
  - 时间范围。
- 支持分页：
  - 默认每页显示 30 条。
  - 用户可选择每页显示 100 或 200 条，也可手动输入条数。
- 结果按最近访问时间降序排列。

#### 2.3.2 界面风格
- 现代化、简洁风格，采用白色与浅灰主色调，辅以蓝色/绿色点缀交互控件。
- 不提供深色模式。

---

## 三、非功能需求

### 3.1 系统部署
- 所有服务均为单节点部署，无需多实例支持。
- 提供 `Dockerfile` 和 `docker-compose` 文件，方便用户部署。

### 3.2 性能与安全
- 性能不做特别优化。
- 数据不需要加密。
- 无需支持特定时间段的访问提醒或浏览器使用统计功能。

### 3.3 系统日志
- 插件与后端记录系统日志，用于调试和问题定位。
- 日志内容包括：
  - 插件的历史记录上报情况。
  - 查询请求的条件与结果数量。
  - 日志文件以 JSON 格式保存。

---

## 四、系统架构

### 4.1 模块划分
1. **插件模块**  
   - 功能：采集和上报浏览器历史记录，支持配置功能。
   - 技术：标准 Chrome 插件开发规范。

2. **后端模块**  
   - 功能：存储和查询历史记录，记录系统日志。
   - 技术：Rust 开发，使用 Elasticsearch 和 MongoDB。

3. **前端模块**  
   - 功能：提供查询历史记录的用户界面。
   - 技术：Vue 3。

### 4.2 数据流
1. 用户浏览网页，插件实时采集历史记录。
2. 插件通过接口将历史记录上报至后端服务。
3. 用户通过前端查询历史记录，后端从 Elasticsearch 中获取数据并返回结果。

---

## 五、技术栈

- **插件**：Chrome 插件开发（JavaScript/HTML/CSS）。
- **后端**：Rust、Elasticsearch、MongoDB。
- **前端**：Vue 3。
- **容器化**：Docker、Docker Compose。

---

## 六、开发与测试计划

### 6.1 开发阶段
1. 插件功能开发与测试。
2. 后端接口与服务实现。
3. 前端界面开发。

### 6.2 测试范围
1. 插件：
   - 历史记录采集准确性。
   - 上报失败的提示与缓存机制。
2. 后端：
   - 数据查询准确性与性能测试。
   - 日志记录功能。
3. 前端：
   - 条件筛选与分页功能测试。
   - 界面交互测试。

### 6.3 部署与验收
- 提供可本地运行的 Docker 镜像及 Compose 文件。
- 用户确认系统功能满足需求后完成验收。

---

如需调整或补充，请随时告知！
