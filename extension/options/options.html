<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Browser History Manager Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <h1>Browser History Manager Settings</h1>
    
    <div class="tabs">
      <button class="tab-button active" data-tab="general">General</button>
      <button class="tab-button" data-tab="sync">Sync</button>
      <button class="tab-button" data-tab="system">System</button>
    </div>
    
    <!-- 通用设置选项卡 -->
    <div class="tab-content active" id="general-tab">
      <section class="server-settings">
        <h2>Server Settings</h2>
        <div class="setting-item">
          <label for="backendUrl">Backend URL:</label>
          <input type="text" id="backendUrl" class="full-width">
          <button id="saveBackendUrl" class="action-button">Save</button>
          <span id="urlStatus" class="status-text"></span>
        </div>
        
        <div class="setting-item">
          <label>
            <input type="checkbox" id="highlightToggle">
            Highlight visited links
          </label>
          <p class="setting-desc">When enabled, links that you've visited before will be highlighted with a blue border.</p>
          <button id="saveHighlight" class="action-button">Save</button>
          <span id="highlightStatus" class="status-text"></span>
        </div>

        <div class="setting-item">
          <h3>URL Pattern Mapping</h3>
          <p class="setting-desc">
            <strong>Note:</strong> These rules are used for URL normalization during link highlighting. When checking if a link has been visited, the URL will be matched against these patterns and transformed before querying the history.
            This allows similar URLs (like <code>abc.com/1#side</code> and <code>abc.com/1-top</code>) to be treated as the same URL (<code>abc.com/1</code>) for highlighting purposes.
            Each rule is applied once per URL, and processing stops after the first successful match.
          </p>
          
          <div id="urlMappingsContainer">
            <div class="url-mapping-header">
              <span>Regex Pattern (JS)</span>
              <span>Replacement</span>
              <span>Actions</span>
            </div>
            <div id="urlMappingsList">
              <!-- URL mappings will be inserted here -->
            </div>
            <div class="url-mapping-controls">
              <button id="addUrlMapping" class="action-button">Add New Rule</button>
              <span id="urlMappingStatus" class="status-text"></span>
            </div>
          </div>
          
          <div class="url-mapping-example">
            <h4>Example:</h4>
            <div class="example-item">
              <strong>Pattern:</strong> <code>https://abc\.com/(\d+).*</code><br>
              <strong>Replacement:</strong> <code>https://abc.com/$1</code><br>
              <strong>Result:</strong> Both <code>https://abc.com/1#side</code> and <code>https://abc.com/1-top</code> → <code>https://abc.com/1</code><br>
              <em>This means visiting either URL will highlight both links on the page.</em>
            </div>
          </div>
        </div>
      </section>
    </div>
    
    <!-- 同步选项卡 -->
    <div class="tab-content" id="sync-tab">
      <section class="pending-records">
        <h2>Pending Records</h2>
        <div class="records-info">
          <span id="pendingCount">Loading...</span>
          <button id="retryAll" class="action-button">Sync All Pending Records</button>
        </div>
        <div id="recordsList" class="records-list">
          <!-- Records will be inserted here -->
        </div>
      </section>

      <section class="manual-sync">
        <h2>Manual Sync</h2>
        <div class="sync-controls">
          <div class="date-range">
            <label>
              From:
              <input type="datetime-local" id="syncStartTime">
            </label>
            <label>
              To:
              <input type="datetime-local" id="syncEndTime">
            </label>
          </div>
          <button id="startSync" class="action-button">Start Sync</button>
        </div>
        <div id="syncProgress" class="sync-progress">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <div class="progress-text"></div>
        </div>
      </section>
    </div>
    
    <!-- 系统设置选项卡 -->
    <div class="tab-content" id="system-tab">
      <section class="system-settings">
        <h2>System Settings</h2>
        
        <div class="setting-item">
          <label for="logLevel">Log Level:</label>
          <select id="logLevel">
            <option value="DEBUG">DEBUG - All logs</option>
            <option value="INFO">INFO - Standard information</option>
            <option value="WARN">WARN - Warnings and errors</option>
            <option value="ERROR">ERROR - Only errors</option>
            <option value="NONE">NONE - No logging</option>
          </select>
          <button id="saveLogLevel" class="action-button">Save</button>
          <span id="logLevelStatus" class="status-text"></span>
          <p class="setting-desc">Set logging verbosity level for extension components.</p>
        </div>
        
        <div class="setting-item">
          <h3>Current Settings</h3>
          <div id="currentSettings" class="settings-display">
            <!-- Current settings will be displayed here -->
          </div>
        </div>
      </section>
    </div>
  </div>
  <script src="options.js" type="module"></script>
</body>
</html> 